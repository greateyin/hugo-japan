{{/*
Archives Layout - Tech Insights Style
*/}}
{{ define "main" }}

{{/* Page Header */}}
<section class="ti-page-header">
  <div class="ti-container">
    <h1 class="ti-page-title">{{ .Title }}</h1>
    {{ with .Description }}
    <p class="ti-page-subtitle">{{ . }}</p>
    {{ end }}
  </div>
</section>

{{/* Archives Content */}}
<section class="ti-archives">
  <div class="ti-container">
    <div class="ti-archives-wrapper">

      {{ if .Content }}
      <div class="ti-archives-intro">
        {{ .Content }}
      </div>
      {{ end }}

      {{/* Get all regular pages sorted by date descending */}}
      {{ $pages := where site.RegularPages "Section" "posts" }}
      {{ $pages = $pages | lang.Merge (where site.RegularPages "Section" "post") }}

      {{/* Group by Year */}}
      {{ range $pages.GroupByDate "2006" }}
      <div class="ti-archive-year">
        <h2 class="ti-archive-year-title">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
            stroke-linecap="round" stroke-linejoin="round">
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
            <line x1="16" y1="2" x2="16" y2="6"></line>
            <line x1="8" y1="2" x2="8" y2="6"></line>
            <line x1="3" y1="10" x2="21" y2="10"></line>
          </svg>
          {{ .Key }}
          <span class="ti-archive-count">{{ len .Pages }}</span>
        </h2>

        {{/* Group by Month within Year */}}
        {{ range .Pages.GroupByDate "January" }}
        <div class="ti-archive-month">
          <h3 class="ti-archive-month-title">
            {{ .Key }}
            <span class="ti-archive-count-small">{{ len .Pages }}</span>
          </h3>

          <ul class="ti-archive-posts">
            {{ range .Pages }}
            <li class="ti-archive-post">
              <a href="{{ .Permalink }}" class="ti-archive-post-link">
                <span class="ti-archive-post-date">{{ .Date.Format "01-02" }}</span>
                <span class="ti-archive-post-title">{{ .Title }}</span>
                {{ with .Params.categories }}
                <span class="ti-archive-post-category">{{ index . 0 }}</span>
                {{ end }}
              </a>
            </li>
            {{ end }}
          </ul>
        </div>
        {{ end }}
      </div>
      {{ end }}

      {{/* If no posts found */}}
      {{ if eq (len $pages) 0 }}
      <div class="ti-empty-state">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
          stroke-linecap="round" stroke-linejoin="round">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
          <polyline points="14 2 14 8 20 8"></polyline>
          <line x1="16" y1="13" x2="8" y2="13"></line>
          <line x1="16" y1="17" x2="8" y2="17"></line>
        </svg>
        <h3>{{ i18n "no_posts_found" | default "No posts found" }}</h3>
      </div>
      {{ end }}

    </div>
  </div>
</section>

<style>
  /* Archives Styles */
  .ti-archives {
    padding: 3rem 0 5rem;
  }

  .ti-archives-wrapper {
    max-width: 800px;
    margin: 0 auto;
  }

  .ti-archives-intro {
    margin-bottom: 2rem;
    padding: 1.5rem;
    background: hsl(var(--ti-card));
    border-radius: var(--ti-radius);
    border: 2px solid hsl(var(--ti-border));
  }

  .ti-archive-year {
    margin-bottom: 2.5rem;
  }

  .ti-archive-year-title {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    font-size: 1.5rem;
    font-family: 'Noto Serif JP', serif;
    padding-bottom: 0.75rem;
    border-bottom: 3px solid hsl(var(--ti-primary));
    margin-bottom: 1.5rem;
  }

  .ti-archive-year-title svg {
    width: 24px;
    height: 24px;
    color: hsl(var(--ti-primary));
  }

  .ti-archive-count {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-width: 2rem;
    padding: 0.25rem 0.75rem;
    background: var(--ti-gradient-primary);
    color: hsl(var(--ti-primary-foreground));
    border-radius: 9999px;
    font-size: 0.875rem;
    font-weight: 600;
    margin-left: auto;
  }

  .ti-archive-month {
    margin-left: 1.5rem;
    margin-bottom: 1.5rem;
  }

  .ti-archive-month-title {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 1rem;
    font-weight: 600;
    color: hsl(var(--ti-muted-foreground));
    margin-bottom: 0.75rem;
  }

  .ti-archive-count-small {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-width: 1.5rem;
    padding: 0.125rem 0.5rem;
    background: hsl(var(--ti-muted));
    color: hsl(var(--ti-muted-foreground));
    border-radius: 9999px;
    font-size: 0.75rem;
  }

  .ti-archive-posts {
    list-style: none;
    padding: 0;
    margin: 0 0 0 1rem;
  }

  .ti-archive-post {
    border-bottom: 1px solid hsl(var(--ti-border));
  }

  .ti-archive-post:last-child {
    border-bottom: none;
  }

  .ti-archive-post-link {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 0.875rem 1rem;
    text-decoration: none;
    color: hsl(var(--ti-foreground));
    border-radius: var(--ti-radius-sm);
    transition: var(--ti-transition-fast);
  }

  .ti-archive-post-link:hover {
    background: hsl(var(--ti-muted) / 0.5);
  }

  .ti-archive-post-date {
    font-size: 0.875rem;
    color: hsl(var(--ti-muted-foreground));
    font-family: monospace;
    min-width: 3rem;
  }

  .ti-archive-post-title {
    flex: 1;
    font-weight: 500;
    transition: var(--ti-transition-fast);
  }

  .ti-archive-post-link:hover .ti-archive-post-title {
    color: hsl(var(--ti-primary));
  }

  .ti-archive-post-category {
    font-size: 0.75rem;
    padding: 0.25rem 0.75rem;
    background: hsl(var(--ti-secondary) / 0.3);
    color: hsl(var(--ti-secondary-foreground));
    border-radius: 9999px;
  }

  @media (max-width: 640px) {
    .ti-archive-post-link {
      flex-wrap: wrap;
    }

    .ti-archive-post-category {
      margin-left: 4rem;
      margin-top: 0.25rem;
    }
  }
</style>

{{ end }}