{{/*
Mermaid Diagram Support
Enable by setting mermaid: true in front matter or site params
*/}}

<!-- Mermaid JS for diagram rendering -->
<script type="module">
  import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';

  mermaid.initialize({
    startOnLoad: false,
    theme: '{{ site.Params.mermaid_theme | default "default" }}',
    securityLevel: 'loose',
    fontFamily: '{{ site.Params.mermaid_font | default "inherit" }}'
  });

  // Transform code blocks with language-mermaid to mermaid divs
  document.addEventListener('DOMContentLoaded', function () {
    const mermaidBlocks = document.querySelectorAll('code.language-mermaid');
    mermaidBlocks.forEach((block, index) => {
      const pre = block.parentElement;
      const content = block.textContent;

      // Create a new div for mermaid
      const div = document.createElement('div');
      div.className = 'mermaid';
      div.id = 'mermaid-' + index;
      div.textContent = content;

      // Replace the pre element with the mermaid div
      pre.parentNode.replaceChild(div, pre);
    });

    // Run mermaid after transformation
    mermaid.run();
  });
</script>
<style>
  /* Mermaid diagram container styles */
  .mermaid {
    text-align: center;
    margin: 1.5rem 0;
    background: #f8f9fa;
    padding: 1rem;
    border-radius: 8px;
  }

  .mermaid svg {
    max-width: 100%;
    height: auto;
  }
</style>